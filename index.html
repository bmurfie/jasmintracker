<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content">
    <title>Jasmin's Workout Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap');
        
        /* Professional Blue-Pink Color System */
        :root {
            --primary-blue: #4A90E2;
            --primary-dark: #2E5C8A;
            --accent-rose: #E87DAB;
            --accent-lavender: #9B7EBD;
            --accent-coral: #FF9A8B;
            --bg-light: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border-light: #E2E8F0;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
        }

        /* Dark Mode */
        body.dark-mode {
            --primary-blue: #5BA3F5;
            --primary-dark: #4A90E2;
            --accent-rose: #F591BD;
            --accent-lavender: #B399D1;
            --accent-coral: #FFA89E;
            --bg-light: #1E293B;
            --bg-card: #0F172A;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-muted: #94A3B8;
            --border-light: #334155;
            --success: #34D399;
            --warning: #FBBF24;
            --error: #F87171;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #F0F4FF 0%, #FFF5F9 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* App Container */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--bg-card);
            box-shadow: 0 0 60px rgba(74, 144, 226, 0.08);
        }

        /* Top Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-lavender) 100%);
            color: white;
            padding: 24px 20px 64px 20px;
            text-align: center;
            position: relative;
        }
        
        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .app-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }
        
        .app-subtitle {
            font-size: 0.875rem;
            opacity: 0.92;
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        /* Tab Navigation */
        .tab-bar {
            display: flex;
            background: var(--bg-card);
            margin-top: -44px;
            margin-left: 16px;
            margin-right: 16px;
            border-radius: 16px;
            padding: 4px;
            box-shadow: 0 4px 24px rgba(74, 144, 226, 0.12);
            position: relative;
            z-index: 10;
            gap: 4px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 10px 6px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.688rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            position: relative;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.24);
        }
        
        .tab-btn:not(.active):hover {
            background: var(--bg-light);
            color: var(--primary-blue);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Workout Tracker View */
        .workout-controls {
            padding: 20px;
            display: flex;
            gap: 12px;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border-light);
        }
        
        .workout-controls select,
        .workout-controls input {
            flex: 1;
            padding: 12px 14px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .workout-controls select:focus,
        .workout-controls input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        /* Progress Ring */
        .progress-section {
            padding: 24px 20px;
            text-align: center;
        }
        
        .progress-ring {
            width: 130px;
            height: 130px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 7;
        }
        
        .progress-ring .bg-circle {
            stroke: var(--border-light);
        }
        
        .progress-ring .progress-circle {
            stroke: url(#progressGradient);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.6s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-blue);
        }
        
        .progress-label {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .progress-sublabel {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Exercise Card */
        .exercise-card {
            margin: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(74, 144, 226, 0.06);
        }
        
        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .exercise-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .exercise-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .badge-compound,
        .badge-isolation {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.688rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            margin-left: 8px;
        }
        
        .badge-compound {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
        }
        
        .badge-isolation {
            background: var(--accent-rose);
            color: white;
        }

        /* Exercise Swap Button */
        .exercise-swap-btn {
            background: var(--accent-lavender);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.813rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .exercise-swap-btn:hover {
            background: var(--accent-rose);
            transform: translateY(-2px);
        }

        /* Sets Input */
        .sets-input {
            margin-top: 20px;
        }
        
        .set-row {
            display: grid;
            grid-template-columns: 50px 1fr 1fr 70px;
            gap: 8px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .set-label {
            font-weight: 700;
            color: var(--primary-blue);
            font-size: 0.813rem;
        }
        
        .set-row input {
            padding: 10px 6px;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.875rem;
            font-weight: 600;
            text-align: center;
            background: var(--bg-card);
            color: var(--text-primary);
            min-width: 0;
            width: 100%;
        }
        
        .set-row input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .set-row input::placeholder {
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .tonnage {
            font-weight: 700;
            color: var(--success);
            font-size: 0.813rem;
            text-align: center;
            white-space: nowrap;
        }

        /* Notes Textarea */
        .exercise-notes {
            margin-top: 20px;
        }
        
        .exercise-notes label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .exercise-notes textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.875rem;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            min-height: 70px;
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        .exercise-notes textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        /* Navigation Buttons */
        .nav-buttons {
            margin-top: 24px;
            display: flex;
            gap: 12px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.938rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }
        
        .nav-btn-secondary:hover {
            background: var(--border-light);
        }
        
        .nav-btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.25);
        }
        
        .nav-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 144, 226, 0.35);
        }
        
        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Stats View */
        .analytics-section {
            padding: 20px;
        }
        
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.04);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-blue);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.813rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Content Card */
        .content-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(74, 144, 226, 0.04);
        }
        
        .content-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        /* PR List */
        .pr-item {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .pr-exercise-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.938rem;
        }
        
        .pr-stats {
            font-size: 0.813rem;
            color: var(--text-secondary);
        }

        /* PR Remove Button */
        .pr-remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--error);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: all 0.2s;
        }

        .pr-remove-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* History View */
        .history-section {
            padding: 20px;
        }
        
        .history-calendar {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(74, 144, 226, 0.04);
        }
        
        .calendar-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 18px;
            text-align: center;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            background: var(--bg-light);
            color: var(--text-primary);
        }
        
        .calendar-day.workout-day {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
        }
        
        .calendar-day.today {
            border: 2px solid var(--primary-blue);
        }

        .history-item {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            position: relative;
        }
        
        .history-date {
            font-size: 0.813rem;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .history-workout-name {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .history-sets {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .delete-workout-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--error);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: all 0.2s;
        }

        .delete-workout-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Charts View */
        .charts-section {
            padding: 20px;
        }

        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(74, 144, 226, 0.04);
        }
        
        .chart-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 18px;
            text-align: center;
        }
        
        .chart-canvas {
            height: 260px;
            width: 100%;
        }

        /* Nutrition View */
        .nutrition-section {
            padding: 20px;
        }

        .macro-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.04);
        }
        
        .macro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .macro-name {
            font-weight: 700;
            font-size: 1.063rem;
            color: var(--text-primary);
        }
        
        .macro-value {
            font-weight: 800;
            font-size: 1.25rem;
            color: var(--primary-blue);
        }
        
        .macro-bar {
            height: 8px;
            background: var(--bg-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        
        .macro-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .macro-protein .macro-fill {
            background: linear-gradient(90deg, var(--accent-rose), #D946A6);
        }
        
        .macro-carbs .macro-fill {
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-lavender));
        }
        
        .macro-fats .macro-fill {
            background: linear-gradient(90deg, var(--warning), #F97316);
        }
        
        .macro-subtext {
            font-size: 0.813rem;
            color: var(--text-secondary);
        }

        .nutrition-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .nutrition-table th {
            background: var(--bg-light);
            color: var(--text-primary);
            padding: 12px;
            font-weight: 700;
            text-align: left;
            font-size: 0.813rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border-bottom: 2px solid var(--border-light);
        }
        
        .nutrition-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .nutrition-table tr:last-child td {
            border-bottom: none;
        }

        /* Plan View */
        .plan-section {
            padding: 20px;
        }

        .plan-subsection {
            margin-bottom: 24px;
        }
        
        .plan-subsection h4 {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 14px;
            font-size: 1.063rem;
        }
        
        .exercise-list-item {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-list-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .exercise-list-sets {
            font-weight: 700;
            color: var(--primary-blue);
            background: var(--bg-card);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.813rem;
        }
        
        .rest-day {
            background: linear-gradient(135deg, #ECFDF5, #D1FAE5);
            border: 1px solid #6EE7B7;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            color: var(--success);
            margin-bottom: 8px;
        }

        .body.dark-mode .rest-day {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border-color: var(--success);
        }

        /* Supplement List */
        .supplement-list {
            list-style: none;
            padding: 0;
        }
        
        .supplement-list li {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .supplement-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .supplement-name {
            flex: 1;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        
        .supplement-dosage {
            font-weight: 700;
            color: var(--primary-blue);
            background: var(--bg-card);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.813rem;
        }

        .info-box {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 16px;
        }
        
        .info-box-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .info-box-content {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }
        
        .tips-list li {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-size: 0.875rem;
            line-height: 1.6;
        }
        
        .tips-list li strong {
            color: var(--primary-blue);
            display: block;
            margin-bottom: 6px;
        }

        /* Floating Timer */
        .floating-timer {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .floating-timer:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(74, 144, 226, 0.5);
        }
        
        .timer-icon {
            font-size: 1.75rem;
        }

        .timer-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(4px);
        }
        
        .timer-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .timer-modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 360px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .timer-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
        }
        
        .timer-display {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 24px;
            font-variant-numeric: tabular-nums;
        }
        
        .timer-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .timer-preset {
            padding: 12px;
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
        }
        
        .timer-preset:hover {
            background: var(--border-light);
            transform: translateY(-2px);
        }
        
        .timer-preset.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .timer-controls {
            display: flex;
            gap: 12px;
        }

        /* Completion Modal */
        .completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(4px);
        }
        
        .completion-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .completion-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .completion-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        .completion-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        
        .completion-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 24px 0;
        }
        
        .completion-stat {
            background: var(--bg-light);
            padding: 16px;
            border-radius: 12px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .completion-stat strong {
            display: block;
            font-size: 1.5rem;
            color: var(--primary-blue);
            margin-bottom: 4px;
            font-weight: 700;
        }
        
        .completion-quote {
            font-style: italic;
            color: var(--text-muted);
            margin: 20px 0;
            font-size: 0.938rem;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary-blue);
            animation: confettiFall 3s linear forwards;
            pointer-events: none;
        }
        
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
        }

        /* Exercise Swap Modal */
        .swap-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(4px);
        }
        
        .swap-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .swap-modal-content {
            background: var(--bg-card);
            max-width: 90%;
            width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 20px;
            padding: 32px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .swap-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
        }

        .swap-modal-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
        }

        .close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--bg-light);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        .swap-exercise-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .swap-custom-input {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .swap-custom-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .swap-custom-input input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .swap-custom-input button {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .swap-custom-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .swap-divider {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.813rem;
            margin: 16px 0;
            position: relative;
        }

        .swap-divider::before,
        .swap-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: var(--border-light);
        }

        .swap-divider::before {
            left: 0;
        }

        .swap-divider::after {
            right: 0;
        }

        .swap-exercise-item {
            padding: 14px;
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
            font-weight: 600;
        }

        .swap-exercise-item:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateX(4px);
        }

        .swap-exercise-item.current {
            background: var(--accent-rose);
            color: white;
            cursor: not-allowed;
        }

        .body-weight-section {
            padding: 20px;
        }

        .body-weight-input-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(74, 144, 226, 0.04);
        }

        .body-weight-input-row {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            align-items: stretch;
        }

        .body-weight-input-row input {
            flex: 1;
            padding: 12px 14px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s;
            min-width: 0;
        }

        .body-weight-input-row input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .body-weight-input-row button {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-lavender));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .body-weight-input-row button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 144, 226, 0.35);
        }

        .body-weight-current {
            background: var(--bg-light);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-top: 16px;
        }

        .body-weight-current-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-blue);
            line-height: 1;
        }

        .body-weight-current-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .body-weight-history {
            margin-top: 20px;
        }

        .body-weight-entry {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .body-weight-entry-date {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .body-weight-entry-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .body-weight-delete-btn {
            background: var(--error);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: all 0.2s;
            margin-left: 12px;
        }

        .body-weight-delete-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 8px; }
        .mb-2 { margin-bottom: 16px; }
        .mt-2 { margin-top: 16px; }

        /* Responsive - Mobile Optimization */
        @media (max-width: 480px) {
            .app-container {
                box-shadow: none;
            }

            .set-row {
                grid-template-columns: 45px 1fr 1fr 60px;
                gap: 6px;
            }

            .set-label {
                font-size: 0.75rem;
            }

            .set-row input {
                padding: 8px 4px;
                font-size: 0.813rem;
            }

            .tonnage {
                font-size: 0.75rem;
            }

            .exercise-title {
                font-size: 1.125rem;
            }

            .swap-modal-content {
                width: 95%;
                padding: 24px;
            }
        }

        @media (max-width: 380px) {
            .set-row {
                grid-template-columns: 40px 1fr 1fr 55px;
                gap: 4px;
            }

            .set-row input {
                padding: 8px 2px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="app-header">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
                <span id="dark-mode-icon">ðŸŒ™</span>
            </button>
            <div class="app-title">Jasmin's Workout Tracker</div>
            <div class="app-subtitle">High Intensity Training â€¢ Mentzer Protocol</div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab('track')">Track</button>
            <button class="tab-btn" onclick="switchTab('stats')">Stats</button>
            <button class="tab-btn" onclick="switchTab('history')">History</button>
            <button class="tab-btn" onclick="switchTab('charts')">Charts</button>
            <button class="tab-btn" onclick="switchTab('weight')">Weight</button>
            <button class="tab-btn" onclick="switchTab('nutrition')">Nutrition</button>
            <button class="tab-btn" onclick="switchTab('plan')">Plan</button>
        </div>

        <!-- Track Tab -->
        <div id="track-tab" class="tab-content active">
            <!-- Controls -->
            <div class="workout-controls">
                <input type="date" id="workout-date">
                <select id="day-select">
                    <option value="day1">Day 1: Quads</option>
                    <option value="day2">Day 2: Hamstrings</option>
                    <option value="day4">Day 4: Glutes</option>
                    <option value="day5">Day 5: Upper</option>
                    <option value="day6">Day 6: Abs/Core</option>
                </select>
            </div>

            <!-- Progress Ring -->
            <div class="progress-section">
                <div class="progress-ring">
                    <svg width="130" height="130">
                        <defs>
                            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4A90E2" />
                                <stop offset="100%" style="stop-color:#9B7EBD" />
                            </linearGradient>
                        </defs>
                        <circle class="bg-circle" cx="65" cy="65" r="58"></circle>
                        <circle class="progress-circle" cx="65" cy="65" r="58" 
                                stroke-dasharray="364.42" stroke-dashoffset="364.42" id="progress-circle"></circle>
                    </svg>
                    <div class="progress-text" id="progress-text">0/4</div>
                </div>
                <div class="progress-label" id="progress-label">Ready to Begin</div>
                <div class="progress-sublabel" id="progress-sublabel">Select your workout day above</div>
            </div>

            <!-- Current Exercise -->
            <div id="current-exercise-container"></div>

            <!-- Save Workout Button -->
            <div style="padding: 20px;">
                <button class="nav-btn nav-btn-primary" style="width: 100%;" onclick="saveWorkout()">
                    ðŸ’¾ Save Workout
                </button>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="analytics-section">
                <div class="stat-cards">
                    <div class="stat-card">
                        <div class="stat-value" id="total-workouts">0</div>
                        <div class="stat-label">Total Workouts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-streak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-sets">0</div>
                        <div class="stat-label">Total Sets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="prs-count">0</div>
                        <div class="stat-label">Personal Records</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="content-card-title">Personal Records</div>
                    <div id="pr-list-content"></div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
            <div class="history-section">
                <div class="history-calendar">
                    <div class="calendar-title">This Month</div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>

                <div class="content-card">
                    <div class="content-card-title">Recent Workouts</div>
                    <div id="history-list-content"></div>
                </div>
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="charts-tab" class="tab-content">
            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">Workout Volume Trend (Last 10)</div>
                    <canvas id="volume-chart" class="chart-canvas"></canvas>
                </div>

                <div id="exercise-charts-container"></div>
            </div>
        </div>

        <!-- Body Weight Tab -->
        <div id="weight-tab" class="tab-content">
            <div class="body-weight-section">
                <!-- Current Weight Display -->
                <div class="body-weight-input-card">
                    <div class="content-card-title">Log Body Weight</div>
                    
                    <div class="body-weight-input-row">
                        <input type="date" id="weight-date" />
                        <input type="number" id="weight-input" placeholder="Weight (lbs)" step="0.1" />
                        <button onclick="logBodyWeight()">Add</button>
                    </div>

                    <div class="body-weight-current" id="current-weight-display">
                        <div class="body-weight-current-value" id="current-weight-value">--</div>
                        <div class="body-weight-current-label">Current Weight (lbs)</div>
                    </div>
                </div>

                <!-- Body Weight Chart -->
                <div class="chart-container">
                    <div class="chart-title">Body Weight Trend</div>
                    <canvas id="body-weight-chart" class="chart-canvas"></canvas>
                </div>

                <!-- Weight History -->
                <div class="content-card">
                    <div class="content-card-title">Weight History</div>
                    <div id="weight-history-list"></div>
                </div>
            </div>
        </div>

        <!-- Nutrition Tab -->
        <div id="nutrition-tab" class="tab-content">
            <div class="nutrition-section">
                <!-- Daily Macros -->
                <div class="content-card">
                    <div class="content-card-title">Daily Macronutrients</div>
                    
                    <div class="macro-card macro-protein">
                        <div class="macro-header">
                            <div class="macro-name">Protein</div>
                            <div class="macro-value">130-150g</div>
                        </div>
                        <div class="macro-bar">
                            <div class="macro-fill" style="width: 40%;"></div>
                        </div>
                        <div class="macro-subtext">520-600 calories â€¢ Muscle repair & growth</div>
                    </div>

                    <div class="macro-card macro-carbs">
                        <div class="macro-header">
                            <div class="macro-name">Carbohydrates</div>
                            <div class="macro-value">180-220g</div>
                        </div>
                        <div class="macro-bar">
                            <div class="macro-fill" style="width: 50%;"></div>
                        </div>
                        <div class="macro-subtext">720-880 calories â€¢ Energy & performance</div>
                    </div>

                    <div class="macro-card macro-fats">
                        <div class="macro-header">
                            <div class="macro-name">Healthy Fats</div>
                            <div class="macro-value">50-65g</div>
                        </div>
                        <div class="macro-bar">
                            <div class="macro-fill" style="width: 30%;"></div>
                        </div>
                        <div class="macro-subtext">450-585 calories â€¢ Hormones & recovery</div>
                    </div>

                    <div class="info-box" style="margin-top: 20px;">
                        <div class="info-box-title">
                            <span>ðŸ“Š</span>
                            <span>Daily Total</span>
                        </div>
                        <div class="info-box-content">
                            <strong>1,690 - 2,065 calories per day</strong><br>
                            Adjust based on activity level and goals
                        </div>
                    </div>
                </div>

                <!-- Meal Timing -->
                <div class="content-card">
                    <div class="content-card-title">Meal Timing Strategy</div>
                    
                    <div class="tips-list">
                        <li>
                            <strong>Pre-Workout (1-2 hours before)</strong>
                            Complex carbs + lean protein. Examples: Oatmeal with protein powder, banana, or rice with chicken breast.
                        </li>
                        <li>
                            <strong>Post-Workout (within 30 minutes)</strong>
                            Fast-digesting protein + simple carbs. Examples: Whey protein shake with fruit or rice cakes.
                        </li>
                        <li>
                            <strong>Main Meals (3-4 per day)</strong>
                            Balanced portions of protein, complex carbs, healthy fats, and vegetables.
                        </li>
                        <li>
                            <strong>Evening Meal</strong>
                            Higher protein, moderate fats, lower carbs to support overnight recovery.
                        </li>
                    </div>
                </div>

                <!-- Hydration -->
                <div class="content-card">
                    <div class="content-card-title">Hydration Goals</div>
                    
                    <div class="info-box">
                        <div class="info-box-title">
                            <span style="font-size: 1.5rem;">ðŸ’§</span>
                            <span>Daily Water Intake</span>
                        </div>
                        <div class="info-box-content">
                            <strong style="font-size: 1.125rem; display: block; margin-bottom: 8px;">2.5 - 3.0 Liters</strong>
                            Increase on workout days and during hot weather. Hydrate consistently throughout the day.
                        </div>
                    </div>
                </div>

                <!-- Sample Meal Plan -->
                <div class="content-card">
                    <div class="content-card-title">Sample Daily Meal Plan</div>
                    
                    <table class="nutrition-table">
                        <thead>
                            <tr>
                                <th>Meal</th>
                                <th>Foods</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Breakfast</strong></td>
                                <td>3 egg whites + 1 whole egg, oatmeal with berries, Greek yogurt</td>
                            </tr>
                            <tr>
                                <td><strong>Lunch</strong></td>
                                <td>Grilled chicken breast, quinoa, roasted vegetables, avocado</td>
                            </tr>
                            <tr>
                                <td><strong>Snack</strong></td>
                                <td>Protein shake, rice cakes with almond butter</td>
                            </tr>
                            <tr>
                                <td><strong>Dinner</strong></td>
                                <td>Salmon or lean beef, sweet potato, steamed broccoli, olive oil</td>
                            </tr>
                            <tr>
                                <td><strong>Evening</strong></td>
                                <td>Casein protein shake or cottage cheese (optional)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Supplement Stack -->
                <div class="content-card">
                    <div class="content-card-title">Supplement Protocol</div>
                    
                    <div class="plan-subsection">
                        <h4>Morning</h4>
                        <ul class="supplement-list">
                            <li>
                                <div class="supplement-icon">ðŸ’Š</div>
                                <span class="supplement-name">Multivitamin</span>
                                <span class="supplement-dosage">1 tablet</span>
                            </li>
                            <li>
                                <div class="supplement-icon">â˜€ï¸</div>
                                <span class="supplement-name">Vitamin D3</span>
                                <span class="supplement-dosage">2,000 IU</span>
                            </li>
                            <li>
                                <div class="supplement-icon">ðŸŸ</div>
                                <span class="supplement-name">Omega-3 Fish Oil</span>
                                <span class="supplement-dosage">1-2g</span>
                            </li>
                        </ul>
                    </div>

                    <div class="plan-subsection">
                        <h4>Pre-Workout (30 min before)</h4>
                        <ul class="supplement-list">
                            <li>
                                <div class="supplement-icon">â˜•</div>
                                <span class="supplement-name">Caffeine</span>
                                <span class="supplement-dosage">200mg</span>
                            </li>
                            <li>
                                <div class="supplement-icon">âš¡</div>
                                <span class="supplement-name">Creatine Monohydrate</span>
                                <span class="supplement-dosage">5g</span>
                            </li>
                            <li>
                                <div class="supplement-icon">ðŸ”¥</div>
                                <span class="supplement-name">Beta-Alanine</span>
                                <span class="supplement-dosage">3-4g</span>
                            </li>
                            <li>
                                <div class="supplement-icon">ðŸ’ª</div>
                                <span class="supplement-name">Citrulline Malate</span>
                                <span class="supplement-dosage">6-8g</span>
                            </li>
                        </ul>
                    </div>

                    <div class="plan-subsection">
                        <h4>Post-Workout</h4>
                        <ul class="supplement-list">
                            <li>
                                <div class="supplement-icon">ðŸ¥›</div>
                                <span class="supplement-name">Whey Protein Isolate</span>
                                <span class="supplement-dosage">25-30g</span>
                            </li>
                            <li>
                                <div class="supplement-icon">ðŸ”—</div>
                                <span class="supplement-name">BCAAs (optional)</span>
                                <span class="supplement-dosage">5g</span>
                            </li>
                        </ul>
                    </div>

                    <div class="plan-subsection">
                        <h4>Evening</h4>
                        <ul class="supplement-list">
                            <li>
                                <div class="supplement-icon">ðŸŒ™</div>
                                <span class="supplement-name">Magnesium Glycinate</span>
                                <span class="supplement-dosage">400mg</span>
                            </li>
                            <li>
                                <div class="supplement-icon">ðŸ˜´</div>
                                <span class="supplement-name">Casein Protein (optional)</span>
                                <span class="supplement-dosage">20-30g</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plan Tab -->
        <div id="plan-tab" class="tab-content">
            <div class="plan-section">
                <!-- Workout Program -->
                <div class="content-card">
                    <div class="content-card-title">7-Day Training Split</div>
                    
                    <div class="plan-subsection">
                        <h4>Day 1: Quad Focus (Monday)</h4>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Leg Extension <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Hack Squat or Leg Press <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Bulgarian Split Squat <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Sissy Squat <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 2: Hamstring Stretch (Tuesday)</h4>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Lying Hamstring Curl <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Romanian Deadlift <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Seated Hamstring Curl <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Glute-Ham Raise <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 3: Rest Day (Wednesday)</h4>
                        <div class="rest-day">Active Recovery: Light stretching, yoga, or walking</div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 4: Glute Focus (Thursday)</h4>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Hip Thrust <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Smith Machine Reverse Lunge <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Cable Kickback <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Abductor Machine <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 5: Upper Body Push/Pull (Friday)</h4>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Chest Press <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Cable Row <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Shoulder Press <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Bicep Curl <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 6: Abs & Core (Saturday)</h4>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Plank Hold <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— 60s</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Russian Twists <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Hanging Leg Raises <span class="badge-isolation">ISOLATION</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                        <div class="exercise-list-item">
                            <span class="exercise-list-name">Mountain Climbers <span class="badge-compound">COMPOUND</span></span>
                            <span class="exercise-list-sets">1 Ã— Failure</span>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Day 7: Rest Day (Sunday)</h4>
                        <div class="rest-day">Full Recovery: Focus on nutrition, sleep, and hydration</div>
                    </div>
                </div>

                <!-- Movement Focus -->
                <div class="content-card">
                    <div class="content-card-title">Movement & Form Guidelines</div>
                    
                    <div class="plan-subsection">
                        <h4>Mind-Muscle Connection</h4>
                        <div class="tips-list">
                            <li>
                                <strong>Visualize the Target</strong>
                                Before each rep, mentally picture the muscle contracting and stretching under tension.
                            </li>
                            <li>
                                <strong>Controlled Tempo</strong>
                                Use a 2-1-2 tempo: 2 seconds lowering, 1 second squeeze, 2 seconds lifting.
                            </li>
                            <li>
                                <strong>Focus on Sensation</strong>
                                Concentrate on feeling the muscle work, not just moving the weight from point A to B.
                            </li>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Essential Form Cues</h4>
                        <div class="tips-list">
                            <li>
                                <strong>Leg Exercises</strong>
                                Core engaged, knees tracking over toes, full range of motion, maintain neutral spine.
                            </li>
                            <li>
                                <strong>Upper Body</strong>
                                Shoulders back and down, chest up, controlled breathing, stable core throughout.
                            </li>
                            <li>
                                <strong>Hip Thrusts</strong>
                                Squeeze glutes at top, keep ribs down, posterior pelvic tilt, full hip extension.
                            </li>
                            <li>
                                <strong>Core Work</strong>
                                Brace abs as if taking a punch, breathe through nose, maintain neutral spine position.
                            </li>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Breathing Technique</h4>
                        <div class="info-box">
                            <div class="info-box-title">
                                <span>ðŸ«</span>
                                <span>Proper Breathing Pattern</span>
                            </div>
                            <div class="info-box-content">
                                <strong>Eccentric (lowering):</strong> Breathe IN deeply through nose<br>
                                <strong>Concentric (lifting):</strong> Breathe OUT forcefully through mouth<br>
                                <strong>Peak contraction:</strong> Hold breath and squeeze for 1 second
                            </div>
                        </div>
                    </div>

                    <div class="plan-subsection">
                        <h4>Training to Failure</h4>
                        <div class="tips-list">
                            <li>
                                <strong>True Muscular Failure</strong>
                                Cannot complete another rep with proper form despite maximum effort.
                            </li>
                            <li>
                                <strong>Form Breakdown = Stop</strong>
                                End the set immediately if technique deteriorates. Injury prevention is priority.
                            </li>
                            <li>
                                <strong>Positive Failure</strong>
                                For safety on certain exercises, stop when you can't lift the weight (before lowering phase).
                            </li>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Timer -->
    <div class="floating-timer" onclick="openTimer()">
        <span class="timer-icon" id="timer-float-icon">â±ï¸</span>
    </div>

    <!-- Timer Modal -->
    <div class="timer-modal" id="timer-modal">
        <div class="timer-modal-content">
            <h3 class="timer-modal-title">Rest Timer</h3>
            <div class="timer-display" id="timer-display">03:00</div>
            <div class="timer-presets">
                <div class="timer-preset" onclick="setRestTime(60)">1:00</div>
                <div class="timer-preset active" onclick="setRestTime(180)">3:00</div>
                <div class="timer-preset" onclick="setRestTime(300)">5:00</div>
                <div class="timer-preset" onclick="setRestTime(420)">7:00</div>
            </div>
            <div class="timer-controls">
                <button class="nav-btn nav-btn-secondary" onclick="closeTimer()">Close</button>
                <button class="nav-btn nav-btn-primary" id="timer-start-btn" onclick="toggleTimer()">Start</button>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="completion-modal" id="completion-modal">
        <div class="completion-content">
            <div class="completion-icon">ðŸŽ‰</div>
            <div class="completion-title">Workout Complete!</div>
            <div class="completion-stats" id="completion-stats"></div>
            <div class="completion-quote">"The pain you feel today will be the strength you feel tomorrow"</div>
            <button class="nav-btn nav-btn-primary" style="width: 100%;" onclick="closeCompletionModal()">
                Continue
            </button>
        </div>
    </div>

    <!-- Exercise Swap Modal -->
    <div class="swap-modal" id="swap-modal">
        <div class="swap-modal-content">
            <button class="close-btn" onclick="closeSwapModal()">Ã—</button>
            <h2 class="swap-modal-title">ðŸ”„ Swap Exercise</h2>
            <p class="swap-modal-subtitle">Choose or create a replacement exercise</p>
            
            <!-- Custom Exercise Input -->
            <div class="swap-custom-input">
                <input type="text" id="custom-exercise-input" placeholder="Type custom exercise name..." />
                <button onclick="swapToCustomExercise()">Use</button>
            </div>

            <div class="swap-divider">or select from list</div>

            <div class="swap-exercise-list" id="swap-exercise-list"></div>
        </div>
    </div>

    <script>
        // Workout Data - Jasmin's Actual Program
        const workoutData = {
            day1: {
                name: "Day 1: Quad Focus",
                exercises: [
                    {name: "Leg Extension", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "quads"},
                    {name: "Hack Squat or Leg Press", sets: 1, reps: "Failure", type: "compound", muscleGroup: "quads"},
                    {name: "Bulgarian Split Squat", sets: 1, reps: "Failure", type: "compound", muscleGroup: "quads"},
                    {name: "Sissy Squat", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "quads"}
                ]
            },
            day2: {
                name: "Day 2: Hamstring Stretch",
                exercises: [
                    {name: "Lying Hamstring Curl", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "hamstrings"},
                    {name: "Romanian Deadlift", sets: 1, reps: "Failure", type: "compound", muscleGroup: "hamstrings"},
                    {name: "Seated Hamstring Curl", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "hamstrings"},
                    {name: "Glute-Ham Raise", sets: 1, reps: "Failure", type: "compound", muscleGroup: "hamstrings"}
                ]
            },
            day4: {
                name: "Day 4: Glute Focus",
                exercises: [
                    {name: "Hip Thrust", sets: 1, reps: "Failure", type: "compound", muscleGroup: "glutes"},
                    {name: "Smith Machine Reverse Lunge", sets: 1, reps: "Failure", type: "compound", muscleGroup: "glutes"},
                    {name: "Cable Kickback", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "glutes"},
                    {name: "Abductor Machine", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "glutes"}
                ]
            },
            day5: {
                name: "Day 5: Upper Body",
                exercises: [
                    {name: "Chest Press", sets: 1, reps: "Failure", type: "compound", muscleGroup: "chest"},
                    {name: "Cable Row", sets: 1, reps: "Failure", type: "compound", muscleGroup: "back"},
                    {name: "Shoulder Press", sets: 1, reps: "Failure", type: "compound", muscleGroup: "shoulders"},
                    {name: "Bicep Curl", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "biceps"}
                ]
            },
            day6: {
                name: "Day 6: Abs/Core",
                exercises: [
                    {name: "Plank Hold", sets: 1, reps: "60s", type: "isolation", muscleGroup: "core"},
                    {name: "Russian Twists", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "core"},
                    {name: "Hanging Leg Raises", sets: 1, reps: "Failure", type: "isolation", muscleGroup: "core"},
                    {name: "Mountain Climbers", sets: 1, reps: "Failure", type: "compound", muscleGroup: "core"}
                ]
            }
        };

        // Exercise database for swapping
        const exerciseDatabase = {
            quads: ["Leg Extension", "Hack Squat or Leg Press", "Bulgarian Split Squat", "Sissy Squat", "Front Squat", "Leg Press", "Walking Lunges", "Step-Ups"],
            hamstrings: ["Lying Hamstring Curl", "Romanian Deadlift", "Seated Hamstring Curl", "Glute-Ham Raise", "Good Mornings", "Stiff-Leg Deadlifts", "Nordic Curls"],
            glutes: ["Hip Thrust", "Smith Machine Reverse Lunge", "Cable Kickback", "Abductor Machine", "Glute Bridge", "Single Leg Hip Thrust", "Donkey Kicks", "Fire Hydrants"],
            chest: ["Chest Press", "Dumbbell Bench Press", "Incline Press", "Cable Flyes", "Push-Ups", "Decline Press", "Machine Chest Press"],
            back: ["Cable Row", "Barbell Row", "Lat Pulldown", "Pull-Ups", "T-Bar Row", "Seated Row", "Single-Arm Dumbbell Row"],
            shoulders: ["Shoulder Press", "Arnold Press", "Lateral Raises", "Front Raises", "Rear Delt Flyes", "Upright Rows", "Face Pulls"],
            biceps: ["Bicep Curl", "Hammer Curls", "Preacher Curls", "Cable Curls", "Concentration Curls", "Incline Dumbbell Curls"],
            core: ["Plank Hold", "Russian Twists", "Hanging Leg Raises", "Mountain Climbers", "Ab Wheel", "Cable Crunches", "Dead Bug", "Bicycle Crunches"]
        };

        // Storage utility
        const storage = {
            get: (key, defaultValue = null) => {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            },
            set: (key, value) => localStorage.setItem(key, JSON.stringify(value))
        };

        // State
        let currentDay = 'day1';
        let currentExerciseIndex = 0;
        let sessionData = {};
        let volumeChart = null;
        let exerciseCharts = [];
        let bodyWeightChart = null;
        let currentSwapExerciseIndex = null;
        
        // Timer state
        let timerInterval = null;
        let timerSeconds = 180;
        let timerRunning = false;

        // Dark Mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('dark-mode-icon').textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
            storage.set('darkMode', isDark);
            
            // Re-render charts with new colors
            if (document.getElementById('charts-tab').classList.contains('active')) {
                renderCharts();
            }
        }

        function loadDarkMode() {
            const isDark = storage.get('darkMode', false);
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('dark-mode-icon').textContent = 'â˜€ï¸';
            }
        }

        // Initialize
        function init() {
            document.getElementById('workout-date').valueAsDate = new Date();
            document.getElementById('weight-date').valueAsDate = new Date();
            document.getElementById('day-select').addEventListener('change', changeDay);
            
            loadDarkMode();
            changeDay();
            renderAnalytics();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`${tab}-tab`).classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'stats') renderAnalytics();
            if (tab === 'history') renderHistory();
            if (tab === 'charts') renderCharts();
            if (tab === 'weight') renderBodyWeight();
        }

        function changeDay() {
            currentDay = document.getElementById('day-select').value;
            currentExerciseIndex = 0;
            sessionData = {};
            renderExercise();
            updateProgress();
        }

        // Show Exercise Swap Modal
        function showSwapModal(exerciseIndex) {
            currentSwapExerciseIndex = exerciseIndex;
            const workout = workoutData[currentDay];
            const currentExercise = workout.exercises[exerciseIndex];
            const muscleGroup = currentExercise.muscleGroup;
            const availableExercises = exerciseDatabase[muscleGroup] || [];
            
            // Clear custom input
            document.getElementById('custom-exercise-input').value = '';
            
            const listHtml = availableExercises.map(ex => {
                const isCurrent = ex === currentExercise.name;
                return `<div class="swap-exercise-item ${isCurrent ? 'current' : ''}" 
                            onclick="${isCurrent ? '' : `swapExercise(${exerciseIndex}, '${ex}')`}">
                            ${ex} ${isCurrent ? '(Current)' : ''}
                        </div>`;
            }).join('');
            
            document.getElementById('swap-exercise-list').innerHTML = listHtml;
            document.getElementById('swap-modal').classList.add('active');
        }

        // Swap to custom exercise
        function swapToCustomExercise() {
            const customName = document.getElementById('custom-exercise-input').value.trim();
            if (!customName) {
                alert('Please enter an exercise name');
                return;
            }
            
            if (currentSwapExerciseIndex !== null) {
                swapExercise(currentSwapExerciseIndex, customName);
            }
        }

        // Swap Exercise
        function swapExercise(exerciseIndex, newExerciseName) {
            const workout = workoutData[currentDay];
            workout.exercises[exerciseIndex].name = newExerciseName;
            
            // Clear sets for this exercise
            if (sessionData[exerciseIndex]) {
                sessionData[exerciseIndex].sets = {};
            }
            
            closeSwapModal();
            renderExercise();
        }

        // Close Swap Modal
        function closeSwapModal() {
            document.getElementById('swap-modal').classList.remove('active');
            currentSwapExerciseIndex = null;
        }

        function renderExercise() {
            const workout = workoutData[currentDay];
            const exercise = workout.exercises[currentExerciseIndex];
            
            if (!sessionData[currentExerciseIndex]) {
                sessionData[currentExerciseIndex] = {sets: {}, notes: ''};
            }

            const sets = parseInt(exercise.sets) || 1;
            let setsHtml = '';
            for (let i = 1; i <= sets; i++) {
                const set = sessionData[currentExerciseIndex].sets[i] || {weight: '', reps: ''};
                const tonnage = set.weight && set.reps ? (set.weight * set.reps).toFixed(0) : '-';
                setsHtml += `
                    <div class="set-row">
                        <div class="set-label">Set ${i}</div>
                        <input type="number" placeholder="lbs" value="${set.weight}" 
                            id="weight-${currentExerciseIndex}-${i}"
                            onchange="updateSet(${currentExerciseIndex}, ${i}, 'weight', this.value)" />
                        <input type="number" placeholder="reps" value="${set.reps}" 
                            id="reps-${currentExerciseIndex}-${i}"
                            onchange="updateSet(${currentExerciseIndex}, ${i}, 'reps', this.value)" />
                        <div class="tonnage">${tonnage}</div>
                    </div>
                `;
            }

            const typeBadge = exercise.type === 'compound' ? 
                '<span class="badge-compound">COMPOUND</span>' :
                '<span class="badge-isolation">ISOLATION</span>';

            const html = `
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div>
                            <div class="exercise-title">${exercise.name} ${typeBadge}</div>
                            <div class="exercise-subtitle">Exercise ${currentExerciseIndex + 1} of ${workout.exercises.length} â€¢ ${exercise.reps} reps</div>
                        </div>
                    </div>
                    <button class="exercise-swap-btn" onclick="showSwapModal(${currentExerciseIndex})">
                        ðŸ”„ Swap Exercise
                    </button>
                    <div class="sets-input">
                        ${setsHtml}
                    </div>
                    <div class="exercise-notes">
                        <label>Notes (form, feeling, etc.)</label>
                        <textarea id="notes-${currentExerciseIndex}" 
                            placeholder="How did this exercise feel? Any form notes?">${sessionData[currentExerciseIndex].notes}</textarea>
                    </div>
                    <div class="nav-buttons">
                        <button class="nav-btn nav-btn-secondary" onclick="prevExercise()" 
                            ${currentExerciseIndex === 0 ? 'disabled' : ''}>
                            â† Previous
                        </button>
                        <button class="nav-btn nav-btn-primary" onclick="nextExercise()" 
                            ${currentExerciseIndex === workout.exercises.length - 1 ? 'disabled' : ''}>
                            Next â†’
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('current-exercise-container').innerHTML = html;
        }

        function updateSet(exIdx, setNum, field, value) {
            if (!sessionData[exIdx]) sessionData[exIdx] = {sets: {}, notes: ''};
            if (!sessionData[exIdx].sets[setNum]) sessionData[exIdx].sets[setNum] = {weight: 0, reps: 0, tonnage: 0, completed: false};
            
            const weight = parseInt(document.getElementById(`weight-${exIdx}-${setNum}`).value) || 0;
            const reps = parseInt(document.getElementById(`reps-${exIdx}-${setNum}`).value) || 0;
            
            // Store the data but don't mark as completed yet
            if (weight && reps) {
                sessionData[exIdx].sets[setNum] = {weight, reps, tonnage: weight * reps, completed: false};
            } else if (weight || reps) {
                // Partial data - store but definitely not completed
                sessionData[exIdx].sets[setNum] = {weight: weight || 0, reps: reps || 0, tonnage: 0, completed: false};
            }
        }

        function nextExercise() {
            const workout = workoutData[currentDay];
            const notes = document.getElementById(`notes-${currentExerciseIndex}`);
            if (notes) {
                if (!sessionData[currentExerciseIndex]) sessionData[currentExerciseIndex] = {sets: {}, notes: ''};
                sessionData[currentExerciseIndex].notes = notes.value;
            }

            // Mark all sets for this exercise as completed when moving to next
            if (sessionData[currentExerciseIndex]?.sets) {
                Object.keys(sessionData[currentExerciseIndex].sets).forEach(setNum => {
                    const set = sessionData[currentExerciseIndex].sets[setNum];
                    if (set.weight && set.reps) {
                        set.completed = true;
                    }
                });
            }

            // Update progress after marking complete
            updateProgress();

            if (currentExerciseIndex < workout.exercises.length - 1) {
                currentExerciseIndex++;
                renderExercise();
            } else {
                saveWorkout();
            }
        }

        function prevExercise() {
            if (currentExerciseIndex > 0) {
                currentExerciseIndex--;
                renderExercise();
                updateProgress();
            }
        }

        function updateProgress() {
            const workout = workoutData[currentDay];
            if (!workout) return;

            let completedSets = 0;
            let totalSets = 0;

            workout.exercises.forEach((ex, idx) => {
                const sets = parseInt(ex.sets) || 1;
                totalSets += sets;
                if (sessionData[idx]?.sets) {
                    completedSets += Object.keys(sessionData[idx].sets).length;
                }
            });

            const percentage = totalSets > 0 ? (completedSets / totalSets) * 100 : 0;
            const circumference = 2 * Math.PI * 58;
            const offset = circumference - (percentage / 100) * circumference;

            document.getElementById('progress-circle').style.strokeDashoffset = offset;
            document.getElementById('progress-text').textContent = `${completedSets}/${totalSets}`;

            if (completedSets === 0) {
                document.getElementById('progress-label').textContent = "Ready to Begin";
                document.getElementById('progress-sublabel').textContent = `${workout.exercises.length} exercises today`;
            } else if (completedSets === totalSets) {
                document.getElementById('progress-label').textContent = "Workout Complete";
                document.getElementById('progress-sublabel').textContent = "Ready to save";
            } else {
                document.getElementById('progress-label').textContent = `${Math.round(percentage)}% Complete`;
                document.getElementById('progress-sublabel').textContent = `${totalSets - completedSets} sets remaining`;
            }
        }

        function saveWorkout() {
            const workout = workoutData[currentDay];
            const date = document.getElementById('workout-date').value;

            const exercises = workout.exercises.map((ex, idx) => ({
                name: ex.name,
                sets: sessionData[idx]?.sets || {},
                notes: sessionData[idx]?.notes || ''
            }));

            const totalSets = exercises.reduce((sum, ex) => sum + Object.keys(ex.sets).length, 0);

            if (totalSets === 0) {
                alert('No sets logged. Please add workout data first.');
                return;
            }

            const workoutEntry = {
                date,
                day: currentDay,
                name: workout.name,
                exercises,
                totalVolume: totalSets
            };

            const history = storage.get('workoutHistory', []);
            history.push(workoutEntry);
            storage.set('workoutHistory', history);

            updatePRs(exercises);
            showCompletionModal(workoutEntry);
            
            sessionData = {};
            currentExerciseIndex = 0;
            renderExercise();
            updateProgress();
            renderAnalytics();
            renderHistory();
            renderCalendar();
        }

        function updatePRs(exercises) {
            const prs = storage.get('personalRecords', {});
            
            exercises.forEach(ex => {
                Object.values(ex.sets).forEach(set => {
                    if (!prs[ex.name] || set.tonnage > prs[ex.name].tonnage) {
                        prs[ex.name] = {weight: set.weight, reps: set.reps, tonnage: set.tonnage};
                    }
                });
            });

            storage.set('personalRecords', prs);
        }

        // Recalculate all PRs from workout history
        function recalculateAllPRs() {
            const history = storage.get('workoutHistory', []);
            const prs = {};
            
            history.forEach(workout => {
                workout.exercises.forEach(ex => {
                    Object.values(ex.sets).forEach(set => {
                        if (set.weight && set.reps) {
                            const tonnage = set.weight * set.reps;
                            if (!prs[ex.name] || tonnage > prs[ex.name].tonnage) {
                                prs[ex.name] = {
                                    weight: set.weight, 
                                    reps: set.reps, 
                                    tonnage: tonnage
                                };
                            }
                        }
                    });
                });
            });
            
            storage.set('personalRecords', prs);
        }

        function showCompletionModal(workout) {
            const modal = document.getElementById('completion-modal');
            modal.classList.add('active');

            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = ['#4A90E2', '#9B7EBD', '#E87DAB', '#10B981'][Math.floor(Math.random() * 4)];
                    confetti.style.animationDelay = Math.random() * 0.4 + 's';
                    modal.querySelector('.completion-content').appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 25);
            }

            document.getElementById('completion-stats').innerHTML = `
                <div class="completion-stat"><strong>${workout.totalVolume}</strong> sets completed</div>
                <div class="completion-stat"><strong>${workout.exercises.length}</strong> exercises completed</div>
                <div class="completion-stat">Workout: <strong>${workout.name}</strong></div>
            `;
        }

        function closeCompletionModal() {
            document.getElementById('completion-modal').classList.remove('active');
        }

        function renderAnalytics() {
            const history = storage.get('workoutHistory', []);
            const prs = storage.get('personalRecords', {});
            
            document.getElementById('total-workouts').textContent = history.length;
            document.getElementById('total-sets').textContent = history.reduce((sum, w) => sum + w.totalVolume, 0);
            document.getElementById('prs-count').textContent = Object.keys(prs).length;
            
            // Calculate streak
            const streak = calculateStreak(history);
            document.getElementById('current-streak').textContent = streak;

            // Render PR List
            const prContent = document.getElementById('pr-list-content');
            if (Object.keys(prs).length === 0) {
                prContent.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No personal records yet. Complete workouts to set PRs!</div>';
            } else {
                const sortedPRs = Object.entries(prs).sort((a, b) => b[1].tonnage - a[1].tonnage);
                prContent.innerHTML = sortedPRs.map(([exercise, pr]) => `
                    <div class="pr-item">
                        <button class="pr-remove-btn" onclick="removePR('${exercise}')" title="Remove PR">Ã—</button>
                        <div>
                            <div class="pr-exercise-name">${exercise}</div>
                            <div class="pr-stats">${pr.weight} lbs Ã— ${pr.reps} reps â€¢ ${pr.tonnage.toFixed(0)} lbs total</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Remove PR Function
        function removePR(exerciseName) {
            if (confirm(`Remove PR for ${exerciseName}?\n\nThis will recalculate the PR from your workout history.`)) {
                const prs = storage.get('personalRecords', {});
                delete prs[exerciseName];
                storage.set('personalRecords', prs);
                
                // Recalculate in case there's a new PR from history
                recalculateAllPRs();
                
                renderAnalytics();
            }
        }

        function calculateStreak(history) {
            if (history.length === 0) return 0;
            
            const dates = history.map(w => w.date).sort();
            let streak = 1;
            
            for (let i = dates.length - 1; i > 0; i--) {
                const current = new Date(dates[i]);
                const prev = new Date(dates[i - 1]);
                const diffDays = Math.floor((current - prev) / (1000 * 60 * 60 * 24));
                
                if (diffDays <= 2) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function renderHistory() {
            const history = storage.get('workoutHistory', []);
            renderCalendar();
            
            const container = document.getElementById('history-list-content');
            if (history.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No workouts logged yet. Complete your first workout!</div>';
                return;
            }

            const sortedHistory = history.slice().reverse();
            container.innerHTML = sortedHistory.map((w, originalIndex) => {
                const workoutIndex = history.length - 1 - originalIndex;
                return `
                    <div class="history-item">
                        <button class="delete-workout-btn" onclick="deleteWorkout(${workoutIndex})" title="Delete Workout">Ã—</button>
                        <div class="history-date">${new Date(w.date).toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric', year: 'numeric'})}</div>
                        <div class="history-workout-name">${w.name}</div>
                        <div class="history-sets">${w.totalVolume} sets â€¢ ${w.exercises.length} exercises</div>
                    </div>
                `;
            }).join('');
        }

        function deleteWorkout(workoutIndex) {
            if (!confirm('Are you sure you want to delete this workout? This cannot be undone.')) {
                return;
            }

            const history = storage.get('workoutHistory', []);
            history.splice(workoutIndex, 1);
            storage.set('workoutHistory', history);

            // Recalculate PRs after deletion
            recalculateAllPRs();

            // Update all views
            renderHistory();
            renderCalendar();
            renderAnalytics();
            
            // Re-render charts if on charts tab
            const chartsTab = document.getElementById('charts-tab');
            if (chartsTab.classList.contains('active')) {
                renderCharts();
            }
        }

        function renderCalendar() {
            const history = storage.get('workoutHistory', []);
            const workoutDates = new Set(history.map(w => w.date));
            
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            let html = '';
            
            ['S', 'M', 'T', 'W', 'T', 'F', 'S'].forEach(d => {
                html += `<div style="text-align: center; font-weight: 700; color: var(--text-secondary); padding: 6px; font-size: 0.75rem;">${d}</div>`;
            });
            
            for (let i = 0; i < firstDay.getDay(); i++) {
                html += '<div></div>';
            }
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(today.getFullYear(), today.getMonth(), day);
                const dateStr = date.toISOString().split('T')[0];
                const isToday = day === today.getDate();
                const hasWorkout = workoutDates.has(dateStr);
                
                html += `<div class="calendar-day ${hasWorkout ? 'workout-day' : ''} ${isToday ? 'today' : ''}">${day}</div>`;
            }
            
            document.getElementById('calendar-grid').innerHTML = html;
        }

        function renderCharts() {
            const history = storage.get('workoutHistory', []);
            
            if (history.length === 0) {
                document.getElementById('volume-chart').parentElement.innerHTML = 
                    '<div style="text-align: center; color: var(--text-secondary); padding: 60px 20px;">Log workouts to see progress charts</div>';
                return;
            }

            // LIMIT TO LAST 10 WORKOUTS FOR CHART
            const recentHistory = history.slice(-10);
            const sortedHistory = recentHistory.slice().sort((a, b) => new Date(a.date) - new Date(b.date));
            const labels = sortedHistory.map(w => new Date(w.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'}));
            const data = sortedHistory.map(w => w.totalVolume);

            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#F1F5F9' : '#1E293B';
            const gridColor = isDark ? '#334155' : '#E2E8F0';

            const ctx = document.getElementById('volume-chart').getContext('2d');
            if (volumeChart) volumeChart.destroy();

            volumeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Sets',
                        data: data,
                        borderColor: '#4A90E2',
                        backgroundColor: 'rgba(74, 144, 226, 0.08)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#4A90E2',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: textColor,
                                font: { size: 11 }
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: textColor,
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Exercise-specific charts (use full history for these)
            const exerciseData = {};
            history.forEach(w => {
                w.exercises.forEach(ex => {
                    if (!exerciseData[ex.name]) exerciseData[ex.name] = [];
                    const bestSet = Object.values(ex.sets).reduce((best, set) => 
                        set.tonnage > best.tonnage ? set : best, {tonnage: 0});
                    if (bestSet.tonnage > 0) {
                        exerciseData[ex.name].push({date: w.date, tonnage: bestSet.tonnage});
                    }
                });
            });

            const exerciseFreq = Object.keys(exerciseData).map(name => ({
                name,
                count: exerciseData[name].length
            })).sort((a, b) => b.count - a.count).slice(0, 4);

            const container = document.getElementById('exercise-charts-container');
            container.innerHTML = '';
            exerciseCharts.forEach(c => c.destroy());
            exerciseCharts = [];

            const colors = ['#4A90E2', '#9B7EBD', '#10B981', '#F59E0B'];

            exerciseFreq.forEach((ex, idx) => {
                // LIMIT EXERCISE CHARTS TO LAST 10 DATA POINTS TOO
                const exData = exerciseData[ex.name].slice(-10).sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const chartDiv = document.createElement('div');
                chartDiv.className = 'chart-container';
                chartDiv.innerHTML = `
                    <div class="chart-title">${ex.name} (Last 10)</div>
                    <canvas id="ex-chart-${idx}" class="chart-canvas"></canvas>
                `;
                container.appendChild(chartDiv);

                const ctx = document.getElementById(`ex-chart-${idx}`).getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: exData.map(d => new Date(d.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})),
                        datasets: [{
                            label: 'Effective Strength',
                            data: exData.map(d => d.tonnage.toFixed(0)),
                            borderColor: colors[idx],
                            backgroundColor: `${colors[idx]}15`,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: colors[idx],
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: textColor,
                                    font: { size: 11 }
                                },
                                grid: {
                                    color: gridColor
                                }
                            },
                            x: {
                                ticks: {
                                    color: textColor,
                                    maxRotation: 45,
                                    minRotation: 45,
                                    font: { size: 10 }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
                exerciseCharts.push(chart);
            });
        }

        // Timer Functions
        function openTimer() {
            document.getElementById('timer-modal').classList.add('active');
        }

        function closeTimer() {
            document.getElementById('timer-modal').classList.remove('active');
        }

        function setRestTime(seconds) {
            if (timerRunning) return;
            timerSeconds = seconds;
            updateTimerDisplay();
            
            document.querySelectorAll('.timer-preset').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
        }

        function toggleTimer() {
            if (timerRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            timerRunning = true;
            document.getElementById('timer-start-btn').textContent = 'Stop';
            document.getElementById('timer-float-icon').textContent = 'â¸ï¸';
            
            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    if ('vibrate' in navigator) {
                        navigator.vibrate([200, 100, 200]);
                    }
                    alert('Rest time complete!');
                    timerSeconds = 180;
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function stopTimer() {
            timerRunning = false;
            clearInterval(timerInterval);
            document.getElementById('timer-start-btn').textContent = 'Start';
            document.getElementById('timer-float-icon').textContent = 'â±ï¸';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timer-display').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Body Weight Tracking Functions
        function logBodyWeight() {
            const date = document.getElementById('weight-date').value;
            const weight = parseFloat(document.getElementById('weight-input').value);
            
            if (!date) {
                alert('Please select a date');
                return;
            }
            
            if (!weight || weight <= 0) {
                alert('Please enter a valid weight');
                return;
            }
            
            const bodyWeights = storage.get('bodyWeights', []);
            
            // Check if entry for this date already exists
            const existingIndex = bodyWeights.findIndex(w => w.date === date);
            if (existingIndex >= 0) {
                if (confirm('Replace existing weight entry for this date?')) {
                    bodyWeights[existingIndex] = { date, weight };
                } else {
                    return;
                }
            } else {
                bodyWeights.push({ date, weight });
            }
            
            // Sort by date
            bodyWeights.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            storage.set('bodyWeights', bodyWeights);
            
            // Clear input and reset date to today
            document.getElementById('weight-input').value = '';
            document.getElementById('weight-date').valueAsDate = new Date();
            
            renderBodyWeight();
        }

        function deleteBodyWeight(index) {
            if (!confirm('Delete this weight entry?')) {
                return;
            }
            
            const bodyWeights = storage.get('bodyWeights', []);
            bodyWeights.splice(index, 1);
            storage.set('bodyWeights', bodyWeights);
            
            renderBodyWeight();
        }

        function renderBodyWeight() {
            const bodyWeights = storage.get('bodyWeights', []);
            
            // Update current weight display
            if (bodyWeights.length > 0) {
                const latestWeight = bodyWeights[bodyWeights.length - 1].weight;
                document.getElementById('current-weight-value').textContent = latestWeight.toFixed(1);
            } else {
                document.getElementById('current-weight-value').textContent = '--';
            }
            
            // Render chart
            renderBodyWeightChart(bodyWeights);
            
            // Render history list
            const historyContainer = document.getElementById('weight-history-list');
            if (bodyWeights.length === 0) {
                historyContainer.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No weight entries yet. Start tracking!</div>';
            } else {
                const reversedWeights = bodyWeights.slice().reverse();
                historyContainer.innerHTML = reversedWeights.map((entry, reverseIdx) => {
                    const originalIndex = bodyWeights.length - 1 - reverseIdx;
                    const formattedDate = new Date(entry.date).toLocaleDateString('en-US', {
                        weekday: 'short',
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    });
                    
                    // Calculate change from previous
                    let changeHtml = '';
                    if (originalIndex > 0) {
                        const previousWeight = bodyWeights[originalIndex - 1].weight;
                        const change = entry.weight - previousWeight;
                        const changeColor = change > 0 ? 'var(--warning)' : change < 0 ? 'var(--success)' : 'var(--text-muted)';
                        const changeSign = change > 0 ? '+' : '';
                        changeHtml = `<span style="color: ${changeColor}; font-size: 0.875rem; margin-left: 8px;">${changeSign}${change.toFixed(1)}</span>`;
                    }
                    
                    return `
                        <div class="body-weight-entry">
                            <div>
                                <div class="body-weight-entry-date">${formattedDate}</div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div class="body-weight-entry-value">${entry.weight.toFixed(1)} lbs${changeHtml}</div>
                                <button class="body-weight-delete-btn" onclick="deleteBodyWeight(${originalIndex})" title="Delete">Ã—</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function renderBodyWeightChart(bodyWeights) {
            const canvas = document.getElementById('body-weight-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (bodyWeightChart) {
                bodyWeightChart.destroy();
            }
            
            if (bodyWeights.length === 0) {
                // Don't replace the entire parent - just show message without destroying canvas
                const container = canvas.parentElement;
                const existingMsg = container.querySelector('.empty-chart-message');
                if (!existingMsg) {
                    const msg = document.createElement('div');
                    msg.className = 'empty-chart-message';
                    msg.style.cssText = 'text-align: center; color: var(--text-secondary); padding: 60px 20px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%;';
                    msg.textContent = 'Log weight entries to see your progress chart';
                    container.style.position = 'relative';
                    container.appendChild(msg);
                }
                canvas.style.display = 'none';
                return;
            }
            
            // Remove empty message and show canvas
            const container = canvas.parentElement;
            const existingMsg = container.querySelector('.empty-chart-message');
            if (existingMsg) {
                existingMsg.remove();
            }
            canvas.style.display = 'block';
            
            // Show last 30 entries max
            const recentWeights = bodyWeights.slice(-30);
            
            const isDark = document.body.classList.contains('dark-mode');
            const textColor = isDark ? '#F1F5F9' : '#1E293B';
            const gridColor = isDark ? '#334155' : '#E2E8F0';
            
            bodyWeightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recentWeights.map(w => new Date(w.date).toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    })),
                    datasets: [{
                        label: 'Body Weight (lbs)',
                        data: recentWeights.map(w => w.weight),
                        borderColor: '#E87DAB',
                        backgroundColor: 'rgba(232, 125, 171, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#E87DAB',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: textColor,
                                font: { size: 11 },
                                callback: function(value) {
                                    return value.toFixed(1) + ' lbs';
                                }
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: textColor,
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
